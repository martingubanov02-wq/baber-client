<%- include('partials/layout', { title: 'BABER client' }) %>
<canvas id="stars-back" class="stars layer back"></canvas>
<canvas id="stars-mid" class="stars layer mid"></canvas>
<canvas id="stars-front" class="stars layer front"></canvas>

<% if (user) { %>
  <!-- Минимальная страница для вошедших: только HWID и Скачать -->
  <section class="card small dashboard">
    <h2>Кабинет</h2>
    <p class="muted">Ник: <strong><%= user.username %></strong></p>
    <p>
      <% if (!hwidStatus) { %>
        <span class="badge warn">HWID не привязан</span>
      <% } else if (hwidStatus !== 'approved') { %>
        <span class="badge warn">HWID: <%= hwidStatus %></span>
      <% } else { %>
        <span class="badge ok">HWID подтвержден</span>
      <% } %>
    </p>
    <div class="actions">
      <% if (hwidStatus === 'approved') { %>
        <a class="btn glow" href="/download">Скачать клиент</a>
      <% } %>
      <a class="btn outline" href="/hwid">HWID</a>
    </div>
  </section>
<% } else { %>
  <!-- Маркетинговая главная для гостей -->
  <section class="hero card">
    <h1 class="shine">BABER — самый быстрый Autoby & AutoMyst + XRay</h1>
    <p class="muted">Лёгкий клиент с максимальным FPS, умной автозакупкой и точным авто‑мистом. XRay нового поколения — видишь то, что нужно.</p>
    <div class="actions">
      <a class="btn glow" href="/login">Войти</a>
      <a class="btn outline" href="/register">Регистрация</a>
    </div>
  </section>

  <section class="features">
    <div class="feature fade-in">
      <h3>Autobuy</h3>
      <p>Мгновенная автопокупка по лучшим ценам. Никаких лишних кликов — всё за тебя.</p>
    </div>
    <div class="feature fade-in" style="animation-delay:.08s">
      <h3>AutoMyst</h3>
      <p>Умный алгоритм: ловит самые выгодные мисты и экономит время.</p>
    </div>
    <div class="feature fade-in" style="animation-delay:.16s">
      <h3>XRay</h3>
      <p>Точный рендер нужных ресурсов. Видишь полезное — игнорируешь шум.</p>
    </div>
  </section>

  <section class="pricing card">
    <h2>Тарифы BABER</h2>
    <div class="tiers">
      <div class="tier">
        <h3>Неделя</h3>
        <div class="price">49 ₽</div>
        <a class="btn" href="#buy-week" target="_blank" rel="noopener">Купить</a>
      </div>
      <div class="tier pop">
        <div class="badge">Топ</div>
        <h3>Месяц</h3>
        <div class="price">149 ₽</div>
        <a class="btn" href="#buy-month" target="_blank" rel="noopener">Купить</a>
      </div>
      <div class="tier">
        <h3>Навсегда</h3>
        <div class="price">399 ₽</div>
        <a class="btn" href="#buy-forever" target="_blank" rel="noopener">Купить</a>
      </div>
    </div>
    <p class="muted small">Оплата у проверенных продавцов: <a href="#famster" target="_blank" rel="noopener">Famster</a>, <a href="#money" target="_blank" rel="noopener">Money</a>, <a href="#nikitanaga" target="_blank" rel="noopener">Nikitanaga</a>. Заменим на реальные ссылки — просто скажи.</p>
  </section>

  <section class="card small">
    <h3>Сброс HWID — 10 ₽</h3>
    <p class="muted">Сменили ПК? Оформите оплату и напишите админу — быстро подтвердим новый HWID.</p>
    <ul class="links">
      <li><a href="#famster-reset" target="_blank" rel="noopener">Famster</a></li>
      <li><a href="#money-reset" target="_blank" rel="noopener">Money</a></li>
      <li><a href="#nikitanaga-reset" target="_blank" rel="noopener">Nikitanaga</a></li>
    </ul>
    <div class="actions">
      <a class="btn" href="/login">Войти</a>
      <a class="btn outline" href="/register">Регистрация</a>
    </div>
  </section>
<% } %>
<%- include('partials/footer') %>

<script>
// Многослойные звёзды (параллакс): back, mid, front
(function(){
  const layers = [
    { id:'stars-back',  speed: 0.5, size:[0.4,1.0],  alpha:[0.2,0.5], color:[154,214,255] },
    { id:'stars-mid',   speed: 1.0, size:[0.6,1.6],  alpha:[0.3,0.7], color:[130,180,255] },
    { id:'stars-front', speed: 1.7, size:[0.9,2.1],  alpha:[0.4,0.9], color:[255,255,255] },
  ];
  const scenes = [];
  function initLayer(def){
    const cv = document.getElementById(def.id);
    if(!cv) return;
    const ctx = cv.getContext('2d');
    const scene = { cv, ctx, def, w:0, h:0, stars:[] };
    scenes.push(scene);
    function rand(min,max){ return Math.random()*(max-min)+min; }
    function resize(){
      scene.w = cv.width = window.innerWidth;
      scene.h = cv.height = window.innerHeight;
      const count = Math.min(300, Math.floor((scene.w*scene.h)/10000 * (def.speed))); // больше на быстрых слоях
      scene.stars = new Array(count).fill(0).map(()=>({
        x: Math.random()*scene.w,
        y: Math.random()*scene.h,
        r: rand(def.size[0], def.size[1]),
        s: rand(def.speed*0.5, def.speed*1.2),
        a: rand(def.alpha[0], def.alpha[1])
      }));
    }
    function step(){
      const {w,h} = scene; const [r,g,b] = def.color;
      ctx.clearRect(0,0,w,h);
      for(const st of scene.stars){
        ctx.beginPath();
        ctx.fillStyle = `rgba(${r},${g},${b},${st.a})`;
        ctx.arc(st.x, st.y, st.r, 0, Math.PI*2);
        ctx.fill();
        // лёгкий хвост
        ctx.beginPath();
        const grad = ctx.createLinearGradient(st.x, st.y-8, st.x, st.y);
        grad.addColorStop(0, `rgba(${r},${g},${b},0)`);
        grad.addColorStop(1, `rgba(${r},${g},${b},${st.a*0.7})`);
        ctx.strokeStyle = grad; ctx.lineWidth = Math.max(1, st.r*0.5);
        ctx.moveTo(st.x, st.y-8); ctx.lineTo(st.x, st.y); ctx.stroke();
        // движение
        st.y += st.s*1.6; st.x += st.s*0.25;
        if (st.y > h+10 || st.x > w+10){ st.x = Math.random()*w*0.6; st.y = -10; }
      }
      requestAnimationFrame(step);
    }
    resize(); step();
    window.addEventListener('resize', resize);
  }
  layers.forEach(initLayer);
})();
</script>
